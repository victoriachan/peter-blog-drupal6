
(function(){tinymce.PluginManager.requireLangPack('syntaxhl');tinymce.create('tinymce.plugins.SyntaxHL',{init:function(ed,url){var t=this;t.editor=ed;t.url=url;function isSyntaxElm(n){return/^(wysiwyg-syntaxhl)/.test(n.className);};ed.addCommand('mceSyntaxHL',function(){ed.windowManager.open({file:url+'/dialog.php?path='+escape(tinyMCE.baseURL)+'&random='+Math.random(),width:450+parseInt(ed.getLang('syntaxhl.delta_width',0)),height:400+parseInt(ed.getLang('syntaxhl.delta_height',0)),inline:1},{plugin_url:url});});ed.addButton('syntaxhl',{title:'syntaxhl.desc',cmd:'mceSyntaxHL',image:url+'/img/highlight.gif'});ed.onNodeChange.add(function(ed,cm,n){cm.setActive('syntaxhl',n.nodeName=='PRE');});ed.onInit.add(function(){if(ed&&ed.plugins.contextmenu){ed.plugins.contextmenu.onContextMenu.add(function(th,m,e){if(e.nodeName=='PRE'){m.add({title:'Edit syntax settings',icon:'',cmd:'mceSyntax'});}});}});ed.onBeforeSetContent.add(t._macroToPre,t);ed.onBeforeGetContent.add(function(ed,o){t._preToMacro(ed,o);});},createControl:function(n,cm){return null;},getInfo:function(){return{longname:'Syntax Highlighter',author:'Richard Grundy',authorurl:'http://27smiles.com',infourl:'http://27smiles.com',version:"1.0"};},_macroToPre:function(ed,o){var nlChar;if(tinymce.isIE)
nlChar='\r\n';else
nlChar='\n';o.content=o.content.replace(/(<p>)?(<P>)?{syntaxhighlighter ([^}]*)}/g,'<pre class="wysiwyg-syntaxhl $3">');o.content=o.content.replace(/{\/syntaxhighlighter}(<\/p>)?(<\/P>)?/g,'</pre>');},_preToMacro:function(ed,o){if(o.save){if(!tinymce.isIE){var syntaxElements=ed.dom.select('pre.wysiwyg-syntaxhl');for(var i=0;i<syntaxElements.length;i++){var style=ed.dom.getAttrib(syntaxElements[i],'class');style=style.replace(/(wysiwyg-syntaxhl\s*)/g,'');var macroString='{syntaxhighlighter '+style+'}'+ed.dom.encode(this._getText(syntaxElements[i]))+'{/syntaxhighlighter}';ed.dom.setOuterHTML(syntaxElements[i],macroString);}}}},_getText:function(obj){if(obj.nodeType==3)return obj.nodeValue;var txt=new Array(),i=0;while(obj.childNodes[i]){txt[txt.length]=this._getText(obj.childNodes[i]);i++;}
return txt.join("");}});tinymce.PluginManager.add('syntaxhl',tinymce.plugins.SyntaxHL);})();